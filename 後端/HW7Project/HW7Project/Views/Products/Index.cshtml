@model IEnumerable<HW7Project.Models.Products>

@{
    ViewBag.Title = "商品管理";
    Layout = "~/Views/Shared/_Layout_Manager.cshtml";
}

<h2>商品管理</h2>

@*<p>
    @Html.ActionLink("新增商品", "Create")
</p>*@
<a class="btn btn-success" data-toggle="modal" data-target="#exampleModal" id="btnCreate">
    管理
</a>
<table class="table">
    <tr>
        <th>
            @Html.DisplayNameFor(model => model.ProductName)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.PhotoFile)
        </th>
        @*<th>
                @Html.DisplayNameFor(model => model.ImageMimeType)
            </th>*@
        @*<th>
                @Html.DisplayNameFor(model => model.UnitPrice)
            </th>*@
        @*<th>
                @Html.DisplayNameFor(model => model.Description)
            </th>*@
        <th>
            @Html.DisplayNameFor(model => model.UnitsInStock)
        </th>
        <th>
            @Html.DisplayNameFor(model => model.Discontinued)
        </th>
        @*<th>
                @Html.DisplayNameFor(model => model.CreatedDate)
            </th>*@
        <th></th>
    </tr>

    @foreach (var item in Model)
    {
        <tr>
            <td>
                <span class="d-inline-block text-truncate" style="max-width: 300px;">
                    @Html.DisplayFor(modelItem => item.ProductName)
                </span>
            </td>
            <td>
                <img src="@Url.Action("GetImage", new {id=item.ProductID})" width="100" />
                @*@Html.DisplayFor(modelItem => item.PhotoFile)*@
            </td>
            @*<td>
                    @Html.DisplayFor(modelItem => item.ImageMimeType)
                </td>*@
            @*<td>
                    @Html.DisplayFor(modelItem => item.UnitPrice)
                </td>*@
            @*<td>
                    @Html.DisplayFor(modelItem => item.Description)
                </td>*@
            <td>
                @item.UnitsInStock

                @*@Html.DisplayFor(modelItem => item.UnitsInStock)*@
            </td>
            <td>
                @if (item.Discontinued)
                {
                    <i class="bi bi-bag-x text-danger"></i>
                }
                else
                {
                    <i class="bi bi-bag-check text-success"></i>
                }

                @*@Html.DisplayFor(modelItem => item.Discontinued)*@
            </td>
            @*<td>
                    @Html.DisplayFor(modelItem => item.CreatedDate)
                </td>*@
            <td>
                @*@Html.ActionLink("修改", "Edit", new { id=item.ProductID }) |*@
                @*@Html.ActionLink("管理", "Details", new { id = item.ProductID })*@
                <button type="button" class="btn btn-info btnDetail" data-toggle="modal" data-target="#exampleModal" title="@item.ProductID">
                    管理
                </button>


            </td>
        </tr>
    }

</table>



<!-- Button trigger modal -->
<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="exampleModalLabel">詳細資料</h3>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                ...
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/jquery-3.4.1.min.js"></script>
<script>

    $('.btnDetail').click(function (evt) {
        //console.log("/Members/Details/" + evt.target.title);*/
        $('#exampleModal .modal-body').load("/Products/Details/" + evt.target.title);
        $('#exampleModal .modal-footer').empty();
        $('#exampleModal .modal-footer').append(`<button type="button" class="btn btn-secondary" data-dismiss="modal">關閉</button>`);
        $('#exampleModal .modal-footer').append(`<a href="/Products/Edit/${evt.target.title}" class="btn btn-primary">修改</a>`);
    });
    $('#btnCreate').click(function () {
        //console.log(evt.target.id);
        $('#exampleModalLabel').text("新增商品資料");
        $('#exampleModal .modal-body').load("/Products/Create");
    });

    $("#photo").change(() => {
        var oFReader = new FileReader();
        var file = document.getElementById('photo').files[0];
        oFReader.readAsDataURL(file);
        oFReader.onloadend = function (oFRevent) {
            var src = oFRevent.target.result;
            $('#NewPhoto').attr('src', src);
        }
    });
</script>
